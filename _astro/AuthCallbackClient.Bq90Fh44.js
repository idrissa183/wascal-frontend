import{u as v,j as e}from"./useTranslations.3K2L2pz4.js";import{r as u}from"./index.BpawKBta.js";import{u as b}from"./useAuthStore.BcfiTys1.js";import{A as y}from"./AuthLayout.DZtxryXY.js";import{A as N,L as A}from"./Alert.B0cLzLLj.js";import{B as d}from"./Button.BrsDPvoC.js";import{g as S}from"./auth.service.DyqDjy0G.js";const $=()=>{const[a,o]=u.useState("loading"),[g,f]=u.useState(null),{setUser:h,setLoading:n}=b(),t=v();u.useEffect(()=>{(async()=>{try{o("loading"),n(!0);const s=new URLSearchParams(window.location.search),i=s.get("access_token"),m=s.get("refresh_token"),E=s.get("user_id"),c=s.get("error"),x=window.location.pathname.split("/").pop();if(c){let r="Erreur d'authentification OAuth";switch(c){case"oauth_error":r=`Erreur lors de l'authentification avec ${x}`;break;case"invalid_state":r="Session d'authentification invalide ou expirée";break;case"oauth_failed":r=`Impossible de récupérer les informations de ${x}`;break;default:r=`Erreur OAuth: ${c}`}throw new Error(r)}if(!i||!m)throw new Error("Tokens d'authentification manquants");localStorage.setItem("access_token",i),localStorage.setItem("refresh_token",m);const j=S(),l=await fetch(`${j}/api/auth/me`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.detail||"Impossible de récupérer les informations utilisateur")}const _=await l.json();h(_),o("success"),setTimeout(()=>{window.history.replaceState({},document.title,window.location.pathname);const r=sessionStorage.getItem("oauth_return_url")||"/dashboard";sessionStorage.removeItem("oauth_return_url"),window.location.href=r},2e3)}catch(s){f(s instanceof Error?s.message:"Erreur d'authentification OAuth"),o("error")}finally{n(!1)}})()},[h,n]);const p=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),sessionStorage.removeItem("oauth_return_url"),window.location.href="/auth/login"},w=()=>{window.location.href="/dashboard"},k=()=>{switch(a){case"loading":return e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(A,{size:"lg"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:t.auth?.processing_login||"Traitement de la connexion..."}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.auth?.please_wait||"Veuillez patienter pendant que nous vous connectons."})]})]});case"success":return e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/20",children:e.jsx("svg",{className:"h-6 w-6 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:t.auth?.login_success||"Connexion réussie !"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.auth?.redirecting||"Redirection en cours..."})]}),e.jsx(d,{onClick:w,className:"w-full",children:t.auth?.go_to_dashboard})]});case"error":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/20",children:e.jsx("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900 dark:text-white",children:t.auth?.login_failed||"Échec de la connexion"})]}),e.jsx(N,{variant:"destructive",children:g||t.auth?.oauth_error||"Erreur lors de l'authentification OAuth"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{onClick:p,className:"w-full",children:t.auth?.back_to_login||"Retour à la connexion"}),e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/",className:"w-full",children:t.auth?.back_to_home})]})]});default:return null}};return e.jsx(y,{title:a==="success"?t.auth?.login_success||"Connexion réussie":a==="error"?t.auth?.login_failed||"Échec de la connexion":t.auth?.login_title||"Connexion en cours",children:k()})};export{$ as A};
