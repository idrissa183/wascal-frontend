import{a as l}from"./auth.service.DX0mUkDK.js";import{R as E}from"./index.BpawKBta.js";const b=e=>{let o;const r=new Set,t=(i,v)=>{const m=typeof i=="function"?i(o):i;if(!Object.is(m,o)){const y=o;o=v??(typeof m!="object"||m===null)?m:Object.assign({},o,m),r.forEach(g=>g(o,y))}},n=()=>o,c={setState:t,getState:n,getInitialState:()=>f,subscribe:i=>(r.add(i),()=>r.delete(i))},f=o=e(t,n,c);return c},P=e=>e?b(e):b,R=e=>e;function k(e,o=R){const r=E.useSyncExternalStore(e.subscribe,()=>o(e.getState()),()=>o(e.getInitialState()));return E.useDebugValue(r),r}const T=e=>{const o=P(e),r=t=>k(o,t);return Object.assign(r,o),r},U=e=>T;function _(e,o){let r;try{r=e()}catch{return}return{getItem:n=>{var a;const h=f=>f===null?null:JSON.parse(f,void 0),c=(a=r.getItem(n))!=null?a:null;return c instanceof Promise?c.then(h):h(c)},setItem:(n,a)=>r.setItem(n,JSON.stringify(a,void 0)),removeItem:n=>r.removeItem(n)}}const A=e=>o=>{try{const r=e(o);return r instanceof Promise?r:{then(t){return A(t)(r)},catch(t){return this}}}catch(r){return{then(t){return this},catch(t){return A(t)(r)}}}},H=(e,o)=>(r,t,n)=>{let a={storage:_(()=>localStorage),partialize:s=>s,version:0,merge:(s,L)=>({...L,...s}),...o},h=!1;const c=new Set,f=new Set;let i=a.storage;if(!i)return e((...s)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),r(...s)},t,n);const v=()=>{const s=a.partialize({...t()});return i.setItem(a.name,{state:s,version:a.version})},m=n.setState;n.setState=(s,L)=>{m(s,L),v()};const y=e((...s)=>{r(...s),v()},t,n);n.getInitialState=()=>y;let g;const p=()=>{var s,L;if(!i)return;h=!1,c.forEach(u=>{var d;return u((d=t())!=null?d:y)});const S=((L=a.onRehydrateStorage)==null?void 0:L.call(a,(s=t())!=null?s:y))||void 0;return A(i.getItem.bind(i))(a.name).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==a.version){if(a.migrate){const d=a.migrate(u.state,u.version);return d instanceof Promise?d.then(w=>[!0,w]):[!0,d]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,u.state];return[!1,void 0]}).then(u=>{var d;const[w,I]=u;if(g=a.merge(I,(d=t())!=null?d:y),r(g,!0),w)return v()}).then(()=>{S?.(g,void 0),g=t(),h=!0,f.forEach(u=>u(g))}).catch(u=>{S?.(void 0,u)})};return n.persist={setOptions:s=>{a={...a,...s},s.storage&&(i=s.storage)},clearStorage:()=>{i?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>p(),hasHydrated:()=>h,onHydrate:s=>(c.add(s),()=>{c.delete(s)}),onFinishHydration:s=>(f.add(s),()=>{f.delete(s)})},a.skipHydration||p(),g||y},O=H,F=U()(O((e,o)=>({user:null,isAuthenticated:!1,isLoading:!1,error:null,login:async r=>{e({isLoading:!0,error:null});try{const t=await l.login(r);e({user:t.user,isAuthenticated:!0,isLoading:!1,error:null}),console.log("User logged in successfully:",t.user)}catch(t){throw e({user:null,isAuthenticated:!1,isLoading:!1,error:t instanceof Error?t.message:"Login failed"}),t}},register:async r=>{e({isLoading:!0,error:null});try{await l.register(r),e({user:null,isAuthenticated:!1,isLoading:!1,error:null}),console.log("User registered successfully, email verification required")}catch(t){throw e({user:null,isAuthenticated:!1,isLoading:!1,error:t instanceof Error?t.message:"Registration failed"}),t}},logout:async()=>{e({isLoading:!0});try{await l.logout(),e({user:null,isAuthenticated:!1,isLoading:!1,error:null}),console.log("User logged out successfully")}catch(r){console.error("Logout error:",r),e({user:null,isAuthenticated:!1,isLoading:!1,error:null})}},refreshToken:async()=>{try{await l.refreshToken(),l.isAuthenticated()&&e({isAuthenticated:!0})}catch(r){console.error("Token refresh error:",r),e({user:null,isAuthenticated:!1,error:"Session expired"})}},getCurrentUser:async()=>{if(!l.isAuthenticated()){e({user:null,isAuthenticated:!1,isLoading:!1});return}e({isLoading:!0});try{const r=await l.getCurrentUser();e(r?{user:r,isAuthenticated:!0,isLoading:!1,error:null}:{user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(r){console.error("Get current user error:",r),e({user:null,isAuthenticated:!1,isLoading:!1,error:r instanceof Error?r.message:"Failed to get user"})}},changePassword:async(r,t)=>{e({isLoading:!0,error:null});try{await l.changePassword(r,t),e({isLoading:!1})}catch(n){throw e({isLoading:!1,error:n instanceof Error?n.message:"Password change failed"}),n}},requestPasswordReset:async r=>{e({isLoading:!0,error:null});try{await l.requestPasswordReset(r),e({isLoading:!1})}catch(t){throw e({isLoading:!1,error:t instanceof Error?t.message:"Password reset request failed"}),t}},resetPassword:async(r,t)=>{e({isLoading:!0,error:null});try{await l.resetPassword(r,t),e({isLoading:!1})}catch(n){throw e({isLoading:!1,error:n instanceof Error?n.message:"Password reset failed"}),n}},verifyEmail:async r=>{e({isLoading:!0,error:null});try{await l.verifyEmail(r),e({isLoading:!1}),console.log("Email verified successfully, user can now login")}catch(t){throw e({isLoading:!1,error:t instanceof Error?t.message:"Email verification failed"}),t}},resendVerificationEmail:async r=>{e({isLoading:!0,error:null});try{await l.resendVerificationEmail(r),e({isLoading:!1})}catch(t){throw e({isLoading:!1,error:t instanceof Error?t.message:"Failed to resend verification email"}),t}},clearError:()=>e({error:null}),setUser:r=>{e({user:r}),r&&l.isAuthenticated()?e({isAuthenticated:!0}):r||e({isAuthenticated:!1})},setLoading:r=>e({isLoading:r}),setError:r=>e({error:r}),setAuthenticated:r=>e({isAuthenticated:r})}),{name:"auth-store",partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{e&&(l.isAuthenticated()&&!l.isTokenExpired()||(e.user=null,e.isAuthenticated=!1))}}));export{F as u};
