import"./index.BpawKBta.js";import{a as i,P as a,b as o}from"./auth.service.DyqDjy0G.js";class r{static instance;isInitialized=!1;constructor(){}static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){if(!this.isInitialized)try{i.isAuthenticated()&&(await i.getCurrentUser()||await i.logout()),this.isInitialized=!0}catch(t){console.error("Auth initialization error:",t),await i.logout()}}isAuthenticated(){return i.isAuthenticated()&&!i.isTokenExpired()}async requireAuth(){if(!i.isAuthenticated())return this.redirectToLogin(),!1;if(i.isTokenExpired())try{return await i.refreshToken(),!0}catch{return await i.logout(),this.redirectToLogin(),!1}return!0}requireGuest(){this.isAuthenticated()&&this.redirectToDashboard()}isPublicRoute(t){return a.some(e=>{if(e.endsWith("*")){const n=e.slice(0,-1);return t.startsWith(n)}return t===e||t.startsWith(e+"/")})}isProtectedRoute(t){return o.some(e=>{if(e.endsWith("*")){const n=e.slice(0,-1);return t.startsWith(n)}return t===e||t.startsWith(e+"/")})}redirectToLogin(){const t=window.location.pathname,e=this.isPublicRoute(t)?"":`?returnUrl=${encodeURIComponent(t)}`;window.location.href=`/auth/login${e}`}redirectToDashboard(){const e=new URLSearchParams(window.location.search).get("returnUrl");e&&!this.isPublicRoute(e)?window.location.href=e:window.location.href="/dashboard"}async checkRouteAccess(t){return this.isPublicRoute(t)?!0:this.isProtectedRoute(t)?await this.requireAuth():!0}}const h=async()=>{const s=r.getInstance();return await s.initialize(),s},l=async()=>await r.getInstance().requireAuth();export{r as A,h as i,l as r};
