import{u as E,j as e}from"./useTranslations.3K2L2pz4.js";import{r as o}from"./index.BpawKBta.js";import{u as M,t as L,r as T}from"./validation.BVj0pO-N.js";import{A as l}from"./AuthLayout.B1aUOfUe.js";import{u as Z}from"./useAuthStore.DEd4f2p1.js";import{I as j}from"./Input.DshfeKVD.js";import{B as d}from"./Button.BrsDPvoC.js";import{L as v,A as B}from"./Alert.B0cLzLLj.js";import{F as I}from"./ExclamationTriangleIcon.DaTtMRx0.js";import{F as q}from"./CheckCircleIcon.Bt8hlw3h.js";import{F as y}from"./EyeSlashIcon.Cr4r18Zw.js";import{F as N}from"./EyeIcon.Db-6UeUT.js";import{a as D}from"./client.Cc-aT41I.js";import"./utils.DGTNTuzh.js";import"./auth.service.8-EAQZcQ.js";import"./index.BP3dD5_l.js";const U=()=>{const[i,_]=o.useState(!1),[n,k]=o.useState(!1),[P,S]=o.useState(!1),[u,x]=o.useState(null),{resetPassword:C,isLoading:w,error:g,clearError:p}=Z(),s=E(),c=typeof window<"u"&&new URLSearchParams(window.location.search).get("token")||"",{register:m,handleSubmit:F,formState:{errors:f,isValid:V},watch:$}=M({resolver:L(T),mode:"onChange",defaultValues:{token:c}}),t=$("newPassword");o.useEffect(()=>{if(!c){x(!1);return}x(!0)},[c]);const z=async a=>{p();try{await C(a.token,a.newPassword),S(!0)}catch{}},h=(a=>{if(!a)return{strength:0,label:"",color:""};let r=0;a.length>=8&&r++,/[a-z]/.test(a)&&r++,/[A-Z]/.test(a)&&r++,/\d/.test(a)&&r++,/[^A-Za-z0-9]/.test(a)&&r++;const A=[s.auth?.password_strength?.very_weak||"Très faible",s.auth?.password_strength?.weak||"Faible",s.auth?.password_strength?.fair||"Moyen",s.auth?.password_strength?.good||"Fort",s.auth?.password_strength?.strong||"Très fort"],R=["bg-red-500","bg-orange-500","bg-yellow-500","bg-blue-500","bg-green-500"];return{strength:r,label:A[r-1]||"",color:R[r-1]||""}})(t||"");return u===!1?e.jsx(l,{children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 dark:bg-red-900/20",children:e.jsx(I,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:[s.auth?.invalid_reset_link_title||"Lien de réinitialisation invalide"," "]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[s.auth?.invalid_reset_link_message||"Ce lien de réinitialisation n'est plus valide ou a expiré."," "]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{onClick:()=>window.location.href="/auth/forgot-password",className:"w-full",children:s.auth?.request_new_link||"Demander un nouveau lien"}),e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/auth/login",className:"w-full",children:s.auth?.back_to_login||"Retour à la connexion"})]})]})}):P?e.jsx(l,{title:s.auth?.password_changed_title||"Mot de passe modifié",subtitle:s.auth?.password_changed_subtitle||"Votre mot de passe a été modifié avec succès",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 dark:bg-green-900/20",children:e.jsx(q,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:[s.user?.password_changed||"Mot de passe modifié avec succès !"," "]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.auth?.password_change_login_prompt||"Vous pouvez maintenant vous connecter avec votre nouveau mot de passe."})]}),e.jsx(d,{onClick:()=>window.location.href="/auth/login",className:"w-full",children:s.auth?.go_to_login||"Se connecter"})]})}):u===null?e.jsx(l,{title:s.auth?.verifying_link_title||"Vérification...",subtitle:s.auth?.verifying_link_subtitle||"Vérification du lien de réinitialisation",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(v,{size:"lg"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[s.auth?.verifying_link_message||"Vérification du lien de réinitialisation..."," "]})]})}):e.jsx(l,{title:s.auth?.reset_password_title||"Nouveau mot de passe",subtitle:s.auth?.choose_strong_password||"Choisissez un mot de passe fort et sécurisé",children:e.jsxs("div",{className:"space-y-6",children:[g&&e.jsx(B,{variant:"destructive",onClose:p,children:g}),e.jsxs("form",{onSubmit:F(z),className:"space-y-6",children:[e.jsx("input",{type:"hidden",...m("token")}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s.auth?.new_password||"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{id:"newPassword",type:i?"text":"password",autoComplete:"new-password",placeholder:"Votre nouveau mot de passe",error:f.newPassword?.message,className:"pr-10",...m("newPassword")}),e.jsx("button",{type:"button",className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>_(!i),"aria-label":i?s.hidePassword:s.showPassword,children:i?e.jsx(y,{className:"h-5 w-5"}):e.jsx(N,{className:"h-5 w-5"})})]}),t&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full dark:bg-gray-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${h.color}`,style:{width:`${h.strength/5*100}%`}})}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 min-w-[60px]",children:h.label})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-1 text-xs",children:[e.jsxs("div",{className:`flex items-center ${t.length>=8?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:t.length>=8?"✓":"○"}),s.auth?.password_criteria?.length||"8+ caractères"," "]}),e.jsxs("div",{className:`flex items-center ${/[A-Z]/.test(t)?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:/[A-Z]/.test(t)?"✓":"○"}),s.auth?.password_criteria?.uppercase||"Majuscule"," "]}),e.jsxs("div",{className:`flex items-center ${/[a-z]/.test(t)?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:/[a-z]/.test(t)?"✓":"○"}),s.auth?.password_criteria?.lowercase||"Minuscule"," "]}),e.jsxs("div",{className:`flex items-center ${/\d/.test(t)?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:/\d/.test(t)?"✓":"○"}),s.auth?.password_criteria?.number||"Chiffre"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.confirmPassword||"Confirmer le mot de passe"," "]}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{id:"confirmPassword",type:n?"text":"password",autoComplete:"new-password",placeholder:s.auth?.confirm_new_password_placeholder||s.confirmPasswordPlaceholder||"Confirmez votre nouveau mot de passe",error:f.confirmPassword?.message,className:"pr-10",...m("confirmPassword")}),e.jsx("button",{type:"button",className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>k(!n),"aria-label":n?s.hidePassword:s.showPassword,children:n?e.jsx(y,{className:"h-5 w-5"}):e.jsx(N,{className:"h-5 w-5"})})]})]}),e.jsx(d,{type:"submit",disabled:!V||w,className:"w-full",children:w?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(v,{size:"sm"}),e.jsx("span",{className:"ml-2",children:s.auth?.updating_password||"Modification en cours..."})]}):s.auth?.update_password||"Modifier le mot de passe"})]})]})})},b=document.getElementById("reset-password-root");b&&D.createRoot(b).render(o.createElement(U));
