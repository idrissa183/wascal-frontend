import{u as E,j as e}from"./useTranslations.3K2L2pz4.js";import{r}from"./index.BpawKBta.js";import{u as M,t as T,r as Z}from"./validation.BVj0pO-N.js";import{A as l}from"./AuthLayout.DZtxryXY.js";import{u as B}from"./useAuthStore.BcfiTys1.js";import{I as j}from"./Input.DshfeKVD.js";import{B as c}from"./Button.BrsDPvoC.js";import{L as v,A as I}from"./Alert.B0cLzLLj.js";import{F as _}from"./ExclamationTriangleIcon.DaTtMRx0.js";import{F as D}from"./CheckCircleIcon.Bt8hlw3h.js";import{F as y}from"./EyeSlashIcon.Cr4r18Zw.js";import{F as N}from"./EyeIcon.Db-6UeUT.js";import{a as U}from"./client.Cc-aT41I.js";import"./utils.DGTNTuzh.js";import"./auth.service.DyqDjy0G.js";import"./index.BP3dD5_l.js";const q=()=>{const[i,k]=r.useState(!1),[n,P]=r.useState(!1),[S,C]=r.useState(!1),[h,u]=r.useState(null),{resetPassword:F,isLoading:f,error:g,clearError:w}=B(),o=E(),d=typeof window<"u"&&new URLSearchParams(window.location.search).get("token")||"",{register:m,handleSubmit:V,formState:{errors:p,isValid:$},watch:z}=M({resolver:T(Z),mode:"onChange",defaultValues:{token:d}}),s=z("newPassword");r.useEffect(()=>{if(!d){u(!1);return}u(!0)},[d]);const A=async t=>{w();try{await F(t.token,t.newPassword),C(!0)}catch{}},x=(t=>{if(!t)return{strength:0,label:"",color:""};let a=0;t.length>=8&&a++,/[a-z]/.test(t)&&a++,/[A-Z]/.test(t)&&a++,/\d/.test(t)&&a++,/[^A-Za-z0-9]/.test(t)&&a++;const R=["Très faible","Faible","Moyen","Fort","Très fort"],L=["bg-red-500","bg-orange-500","bg-yellow-500","bg-blue-500","bg-green-500"];return{strength:a,label:R[a-1]||"",color:L[a-1]||""}})(s||"");return h===!1?e.jsx(l,{title:"Lien invalide",subtitle:"Le lien de réinitialisation est invalide ou a expiré",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 dark:bg-red-900/20",children:e.jsx(_,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Lien de réinitialisation invalide"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Ce lien de réinitialisation n'est plus valide ou a expiré."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{onClick:()=>window.location.href="/auth/forgot-password",className:"w-full",children:"Demander un nouveau lien"}),e.jsx(c,{variant:"outline",onClick:()=>window.location.href="/auth/login",className:"w-full",children:"Retour à la connexion"})]})]})}):S?e.jsx(l,{title:"Mot de passe modifié",subtitle:"Votre mot de passe a été modifié avec succès",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 dark:bg-green-900/20",children:e.jsx(D,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Mot de passe modifié avec succès !"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Vous pouvez maintenant vous connecter avec votre nouveau mot de passe."})]}),e.jsx(c,{onClick:()=>window.location.href="/auth/login",className:"w-full",children:"Se connecter"})]})}):h===null?e.jsx(l,{title:"Vérification...",subtitle:"Vérification du lien de réinitialisation",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(v,{size:"lg"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vérification du lien de réinitialisation..."})]})}):e.jsx(l,{title:o.auth?.reset_password_title||"Nouveau mot de passe",subtitle:"Choisissez un mot de passe fort et sécurisé",children:e.jsxs("div",{className:"space-y-6",children:[g&&e.jsx(I,{variant:"destructive",onClose:w,children:g}),e.jsxs("form",{onSubmit:V(A),className:"space-y-6",children:[e.jsx("input",{type:"hidden",...m("token")}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{id:"newPassword",type:i?"text":"password",autoComplete:"new-password",placeholder:"Votre nouveau mot de passe",error:p.newPassword?.message,className:"pr-10",...m("newPassword")}),e.jsx("button",{type:"button",className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>k(!i),"aria-label":i?o.hidePassword:o.showPassword,children:i?e.jsx(y,{className:"h-5 w-5"}):e.jsx(N,{className:"h-5 w-5"})})]}),s&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full dark:bg-gray-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${x.color}`,style:{width:`${x.strength/5*100}%`}})}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 min-w-[60px]",children:x.label})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-1 text-xs",children:[e.jsxs("div",{className:`flex items-center ${s.length>=8?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:s.length>=8?"✓":"○"}),"8+ caractères"]}),e.jsxs("div",{className:`flex items-center ${/[A-Z]/.test(s)?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:/[A-Z]/.test(s)?"✓":"○"}),"Majuscule"]}),e.jsxs("div",{className:`flex items-center ${/[a-z]/.test(s)?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:/[a-z]/.test(s)?"✓":"○"}),"Minuscule"]}),e.jsxs("div",{className:`flex items-center ${/\d/.test(s)?"text-green-600":"text-gray-400"}`,children:[e.jsx("span",{className:"mr-1",children:/\d/.test(s)?"✓":"○"}),"Chiffre"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirmer le mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{id:"confirmPassword",type:n?"text":"password",autoComplete:"new-password",placeholder:"Confirmez votre nouveau mot de passe",error:p.confirmPassword?.message,className:"pr-10",...m("confirmPassword")}),e.jsx("button",{type:"button",className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>P(!n),"aria-label":n?o.hidePassword:o.showPassword,children:n?e.jsx(y,{className:"h-5 w-5"}):e.jsx(N,{className:"h-5 w-5"})})]})]}),e.jsx(c,{type:"submit",disabled:!$||f,className:"w-full",children:f?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(v,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Modification en cours..."})]}):"Modifier le mot de passe"})]})]})})},b=document.getElementById("reset-password-root");b&&U.createRoot(b).render(r.createElement(q));
